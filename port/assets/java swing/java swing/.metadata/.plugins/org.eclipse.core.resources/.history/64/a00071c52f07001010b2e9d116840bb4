package swingpack;

import java.awt.*;

import java.awt.event.*;
import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import com.toedter.calendar.JDateChooser;
import java.util.Calendar;
import java.util.HashSet;
import java.util.Set;
import java.text.SimpleDateFormat;
import java.util.Date;

public class T3 extends JFrame {

    private static final long serialVersionUID = 1L;
    private JPanel contentPane;
    private JComboBox<String> classComboBox;
    private JDateChooser dateChooser;
    private JButton submitButton;
    private JRadioButton[][] presentButtons, absentButtons;
    private JPanel studentPanel;
    private JTable timetableTable;
    private JScrollPane timetableScrollPane;
    private JLabel subjectLabel;
    private Set<String> markedDates = new HashSet<>();

    // Store marked attendance dates
    private String[][] students = {
            {   // I BSc. CSCY - 232CY001 to 232CY010 (Sorted Alphabetically)
                "232CY001", "Afsar",
                "232CY002", "Barath",
                "232CY003", "Kathir",
                "232CY004", "Mathi",
                "232CY005", "Naveen",
                "232CY006", "Purusothaman",
                "232CY007", "Sachin",
                "232CY008", "Sakthi",
                "232CY009", "Soumith",
                "232CY010", "Thirumalai"
            },
            {   // II BSc. CSCY - 231CY001 to 231CY010 (Sorted Alphabetically)
                "231CY001", "Kumaresh Karthic",
                "231CY002", "Ravi Shankar",
                "231CY003", "Sakthi Prasath",
                "231CY004", "Srijith",
                "231CY005", "Sujan",
                "231CY006", "Sudharsan",
                "231CY007", "Tamilselvan",
                "231CY008", "Thanigaivel",
                "231CY009", "Vadivelkumaran",
                "231CY010", "Vinoth Kumar"
            }
        };


    private String[][] ibscTimetable = {
        {"Monday", "5,6"},
        {"Tuesday", "3,4"},
        {"Wednesday", "1,2"},
        {"Thursday", "3,4"},
        {"Friday", "1,2"}
    };

    private String[][] iibscTimetable = {
        {"Monday", "5,6"},
        {"Tuesday", "5,6"},
        {"Wednesday", "1,2"},
        {"Thursday", "1,2"},
        {"Friday", "3,4"}
    };

    public static void main(String[] args) {
        EventQueue.invokeLater(() -> {
            try {
                T3 frame = new T3();
                frame.setVisible(true);
            } catch (Exception e) {
                e.printStackTrace();
            }
        });
    }

    public T2() {
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setBounds(100, 100, 1100, 800);
        contentPane = new JPanel();
        contentPane.setLayout(new BorderLayout());
        JScrollPane scrollPane = new JScrollPane(contentPane);
        setContentPane(scrollPane);
        JPanel mainPanel = new JPanel();
        mainPanel.setLayout(null);
        contentPane.add(mainPanel);

        JLabel lblClass = new JLabel("Select Class:");
        lblClass.setBounds(50, 20, 100, 25);
        mainPanel.add(lblClass);

        classComboBox = new JComboBox<>(new String[]{"I BSc. CSCY", "II BSc. CSCY"});
        classComboBox.setBounds(160, 20, 200, 25);
        classComboBox.addActionListener(e -> {
            updateStudentList();
            updateTimetable();
            updateSubjectLabel();
        });
        mainPanel.add(classComboBox);

        subjectLabel = new JLabel();
        subjectLabel.setBounds(400, 20, 300, 25);
        mainPanel.add(subjectLabel);
        updateSubjectLabel();

        JLabel lblDate = new JLabel("Select Date:");
        lblDate.setBounds(50, 60, 100, 25);
        mainPanel.add(lblDate);

        dateChooser = new JDateChooser();
        dateChooser.setBounds(160, 60, 150, 25);
        mainPanel.add(dateChooser);

        Calendar minDate = Calendar.getInstance();
        minDate.set(2024, Calendar.DECEMBER, 2);
        dateChooser.setMinSelectableDate(minDate.getTime());

        Calendar maxDate = Calendar.getInstance();
        maxDate.set(2025, Calendar.APRIL, 2);
        dateChooser.setMaxSelectableDate(maxDate.getTime());

        JLabel lblStudents = new JLabel("Mark Attendance:");
        lblStudents.setBounds(50, 140, 200, 25);
        mainPanel.add(lblStudents);

        studentPanel = new JPanel();
        studentPanel.setLayout(new GridLayout(10, 3, 10, 5));
        studentPanel.setBounds(50, 170, 600, 250);
        mainPanel.add(studentPanel);

        presentButtons = new JRadioButton[2][10];
        absentButtons = new JRadioButton[2][10];
        updateStudentList();

        submitButton = new JButton("Submit");
        submitButton.setBounds(160, 450, 100, 30);
        mainPanel.add(submitButton);

        submitButton.addActionListener(e -> submitAttendance());

        timetableTable = new JTable();
        timetableScrollPane = new JScrollPane(timetableTable);
        timetableScrollPane.setBounds(700, 20, 250, 150);
        mainPanel.add(timetableScrollPane);

        updateTimetable();
    }

    private void updateStudentList() {
        studentPanel.removeAll();
        int classIndex = classComboBox.getSelectedIndex();
        ButtonGroup[] buttonGroups = new ButtonGroup[10];

        for (int i = 0; i < 10; i++) {
            buttonGroups[i] = new ButtonGroup();
            JLabel studentLabel = new JLabel(students[classIndex][i * 2] + " - " + students[classIndex][i * 2 + 1]);
            studentPanel.add(studentLabel);

            presentButtons[classIndex][i] = new JRadioButton("Present");
            absentButtons[classIndex][i] = new JRadioButton("Absent");

            buttonGroups[i].add(presentButtons[classIndex][i]);
            buttonGroups[i].add(absentButtons[classIndex][i]);

            studentPanel.add(presentButtons[classIndex][i]);
            studentPanel.add(absentButtons[classIndex][i]);
        }

        studentPanel.revalidate();
        studentPanel.repaint();
    }

    private void updateTimetable() {
        int classIndex = classComboBox.getSelectedIndex();
        String[][] timetable = (classIndex == 0) ? ibscTimetable : iibscTimetable;

        String[] columnNames = {"Day", "Hours"};
        DefaultTableModel model = new DefaultTableModel(timetable, columnNames);
        timetableTable.setModel(model);
    }

    private void updateSubjectLabel() {
        int classIndex = classComboBox.getSelectedIndex();
        String subject = (classIndex == 0) ? "OBJECT ORIENTED PROGRAM WITH C++" : "PYTHON PROGRAMMING";
        subjectLabel.setText("Subject: " + subject);
    }
    private void submitAttendance() {
        int classIndex = classComboBox.getSelectedIndex();

        // Get the selected date
        Date selectedDate = dateChooser.getDate();
        if (selectedDate == null) {
            JOptionPane.showMessageDialog(this, "Please select a date.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }

        // Format the date as a string
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd");
        String formattedDate = dateFormat.format(selectedDate);

        // Check if attendance has already been marked for this date
        if (markedDates.contains(formattedDate)) {
            JOptionPane.showMessageDialog(this, "Attendance for this date is already marked.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }

        // Ensure all students have attendance marked
        for (int i = 0; i < 10; i++) {
            if (!presentButtons[classIndex][i].isSelected() && !absentButtons[classIndex][i].isSelected()) {
                JOptionPane.showMessageDialog(this, "Please mark attendance for all students.", "Incomplete Attendance", JOptionPane.WARNING_MESSAGE);
                return;
            }
        }

        // Mark attendance as submitted for the selected date
        markedDates.add(formattedDate);

        JOptionPane.showMessageDialog(this, "Attendance submitted successfully.", "Success", JOptionPane.INFORMATION_MESSAGE);
    }
}