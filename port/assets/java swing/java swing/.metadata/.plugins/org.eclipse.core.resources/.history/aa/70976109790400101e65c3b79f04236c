package swingpack;

import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import com.toedter.calendar.JDateChooser;
import java.util.Calendar;

public class T1 extends JFrame {
    private static final long serialVersionUID = 1L;
    private JPanel contentPane;
    private JComboBox<String> classComboBox;
    private JDateChooser dateChooser;
    private JButton submitButton;
    private JTable attendanceTable;
    private DefaultTableModel tableModel;
    private JRadioButton[][] presentButtons, absentButtons;
    private JPanel studentPanel;
    private String[][] students = {
        {"Soumith", "Kathir", "Sachin", "Naveen", "Barath", "Sakthi", "Afsar", "Mathi", "Purusothaman", "Thirumalai"}, // I BSc. CSCY
        { "Kumaresh Karthic","Tamilselvan", "Sujan", "Srijith", "Ravi Shankar", "Sakthi Prasath", "Vinoth Kumar", "Thanigaivel", "Vadivelkumaran", "Sudharsan"} // II BSc. CSCY
    };

    public static void main(String[] args) {
        EventQueue.invokeLater(() -> {
            try {
                T1 frame = new T1();
                frame.setVisible(true);
            } catch (Exception e) {
                e.printStackTrace();
            }
        });
    }

    public T1() {
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setBounds(100, 100, 1100, 750);

        contentPane = new JPanel();
        contentPane.setLayout(new BorderLayout());

        JScrollPane scrollPane = new JScrollPane(contentPane);
        setContentPane(scrollPane);

        JPanel mainPanel = new JPanel();
        mainPanel.setLayout(null);
        contentPane.add(mainPanel);

        JLabel lblClass = new JLabel("Select Class:");
        lblClass.setBounds(50, 20, 100, 25);
        mainPanel.add(lblClass);

        classComboBox = new JComboBox<>(new String[]{"I BSc. CSCY", "II BSc. CSCY"});
        classComboBox.setBounds(160, 20, 200, 25);
        classComboBox.addActionListener(e -> updateStudentList());
        mainPanel.add(classComboBox);

        JLabel lblDate = new JLabel("Select Date:");
        lblDate.setBounds(50, 60, 100, 25);
        mainPanel.add(lblDate);

        dateChooser = new JDateChooser();
        dateChooser.setBounds(160, 60, 150, 25);
        mainPanel.add(dateChooser);

        Calendar minDate = Calendar.getInstance();
        minDate.set(2024, Calendar.DECEMBER, 2);
        dateChooser.setMinSelectableDate(minDate.getTime());

        Calendar maxDate = Calendar.getInstance();
        maxDate.set(2025, Calendar.APRIL, 2);
        dateChooser.setMaxSelectableDate(maxDate.getTime());

        dateChooser.getDateEditor().addPropertyChangeListener("date", evt -> {
            Calendar selectedDate = Calendar.getInstance();
            selectedDate.setTime(dateChooser.getDate());
            int dayOfWeek = selectedDate.get(Calendar.DAY_OF_WEEK);
            if (dayOfWeek == Calendar.SATURDAY || dayOfWeek == Calendar.SUNDAY) {
                JOptionPane.showMessageDialog(this, "Weekends are not allowed.", "Invalid Date", JOptionPane.ERROR_MESSAGE);
                dateChooser.setDate(null);
            }
        });

        JLabel lblStudents = new JLabel("Mark Attendance:");
        lblStudents.setBounds(50, 100, 200, 25);
        mainPanel.add(lblStudents);

        studentPanel = new JPanel();
        studentPanel.setLayout(new GridLayout(10, 3, 10, 5));
        studentPanel.setBounds(50, 130, 600, 250);
        mainPanel.add(studentPanel);

        presentButtons = new JRadioButton[2][10];
        absentButtons = new JRadioButton[2][10];

        updateStudentList();

        submitButton = new JButton("Submit");
        submitButton.setBounds(160, 400, 100, 30);
        mainPanel.add(submitButton);

        tableModel = new DefaultTableModel(new String[]{"Class", "Date", "Student", "Status"}, 0);
        attendanceTable = new JTable(tableModel);
        JScrollPane tableScrollPane = new JScrollPane(attendanceTable);
        tableScrollPane.setBounds(50, 450, 950, 250);
        mainPanel.add(tableScrollPane);

        submitButton.addActionListener(e -> submitAttendance());
    }

    private void updateStudentList() {
        studentPanel.removeAll();
        int classIndex = classComboBox.getSelectedIndex();
        ButtonGroup[] buttonGroups = new ButtonGroup[10];

        for (int i = 0; i < 10; i++) {
            buttonGroups[i] = new ButtonGroup();
            JLabel studentLabel = new JLabel(students[classIndex][i]);
            studentPanel.add(studentLabel);

            presentButtons[classIndex][i] = new JRadioButton("Present");
            absentButtons[classIndex][i] = new JRadioButton("Absent", true);

            buttonGroups[i].add(presentButtons[classIndex][i]);
            buttonGroups[i].add(absentButtons[classIndex][i]);

            studentPanel.add(presentButtons[classIndex][i]);
            studentPanel.add(absentButtons[classIndex][i]);
        }
        studentPanel.revalidate();
        studentPanel.repaint();
    }

    private void submitAttendance() {
        String selectedClass = (String) classComboBox.getSelectedItem();
        String selectedDate = ((JTextField) dateChooser.getDateEditor().getUiComponent()).getText();

        if (selectedDate.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Please select a date.", "Error", JOptionPane.ERROR_MESSAGE);
            return;
        }

        int classIndex = classComboBox.getSelectedIndex();
        for (int i = 0; i < 10; i++) {
            if (!presentButtons[classIndex][i].isSelected() && !absentButtons[classIndex][i].isSelected()) {
                JOptionPane.showMessageDialog(this, "Please mark attendance for all students.", "Error", JOptionPane.ERROR_MESSAGE);
                return;
            }
            String status = presentButtons[classIndex][i].isSelected() ? "Present" : "Absent";
            tableModel.addRow(new Object[]{selectedClass, selectedDate, students[classIndex][i], status});
        }
    }
}
