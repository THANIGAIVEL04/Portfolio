package swingpack;
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import javax.swing.table.DefaultTableModel;
import com.toedter.calendar.JDateChooser;
import java.util.Calendar;
import java.sql.*;
public class T1 extends JFrame {
    private static final long serialVersionUID = 1L;
    private JPanel contentPane;
    private JComboBox<String> classComboBox;
    private JDateChooser dateChooser;
    private JButton submitButton;
    private JTable attendanceTable;
    private DefaultTableModel tableModel;
    private JRadioButton[][] presentButtons, absentButtons;
    private JPanel studentPanel;
    private JTable timetableTable;
    private JScrollPane timetableScrollPane;
    private JLabel subjectLabel;
    private String[][] students = {
        {"Soumith", "Kathir", "Sachin", "Naveen", "Barath", "Sakthi", "Afsar", "Mathi", "Purusothaman", "Thirumalai"},
        {"Kumaresh karthic","Tamilselvan", "Sujan", "Srijith", "Ravi Shankar", "Sakthi Prasath", "Vinoth Kumar", "Thanigaivel", "Vadivelkumaran",  "Sudharsan"} 
    };
    
    private String[][] ibscTimetable = {
    	    {"Monday", "1,2"},
    	    {"Tuesday", "5,6"},
    	    {"Wednesday", "3,4"},
    	    {"Thursday", "5,6"},
    	    {"Friday", "3,4"}
    	};
    	private String[][] iibscTimetable = {
    	    {"Monday", "3,4"},
    	    {"Tuesday", "1,2"},
    	    {"Wednesday", "5,6"},
    	    {"Thursday", "3,4"},
    	    {"Friday", "1,2"}
    	};
    	private Connection connection;
    	public static void main(String[] args) {
    	    EventQueue.invokeLater(() -> {
    	        try {
    	            T1 frame = new T1();
    	            frame.setVisible(true);
    	        } catch (Exception e) {
    	            e.printStackTrace();
    	        }
    	    });
    	}
    	public T1() {
    		initializeDB();
    	    setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    	    setBounds(100, 100, 1100, 800);
    	    contentPane = new JPanel();
    	    contentPane.setLayout(new BorderLayout());
    	    JScrollPane scrollPane = new JScrollPane(contentPane);
    	    setContentPane(scrollPane);
    	    JPanel mainPanel = new JPanel();
    	    contentPane.add(mainPanel);
    	    mainPanel.setLayout(null);
    	    
    	    JLabel lblClass = new JLabel("Select Class:");
    	    lblClass.setBounds(50, 20, 100, 25);
    	    mainPanel.add(lblClass);
    	    classComboBox = new JComboBox<>(new String[]{"I BSc. CSCY", "II BSc. CSCY"});
    	    classComboBox.setBounds(160, 20, 200, 25);
    	    classComboBox.addActionListener(e -> {
    	        updateStudentList();
    	        updateTimetable();
    	        updateSubjectLabel();
    	    });
    	    mainPanel.add(classComboBox);
    	    
    	    subjectLabel = new JLabel();
    	    subjectLabel.setBounds(400, 20, 300, 25);
    	    mainPanel.add(subjectLabel);
    	    updateSubjectLabel();
    	    
    	    JLabel lblDate = new JLabel("Select Date:");
    	    lblDate.setBounds(50, 60, 100, 25);
    	    mainPanel.add(lblDate);
    	    dateChooser = new JDateChooser();
    	    dateChooser.setBounds(160, 60, 150, 25);
    	    dateChooser.getDateEditor().addPropertyChangeListener("date", evt -> checkWeekend());
    	    mainPanel.add(dateChooser);
    	    
    	    Calendar minDate = Calendar.getInstance();
    	    minDate.set(2024, Calendar.DECEMBER, 2);
    	    dateChooser.setMinSelectableDate(minDate.getTime());
    	    Calendar maxDate = Calendar.getInstance();
    	    maxDate.set(2025, Calendar.APRIL, 2);
    	    dateChooser.setMaxSelectableDate(maxDate.getTime());
    	    
    	    JLabel lblStudents = new JLabel("Mark Attendance:");
    	    lblStudents.setBounds(50, 140, 200, 25);
    	    mainPanel.add(lblStudents);
    	    studentPanel = new JPanel();
    	    studentPanel.setBounds(50, 170, 600, 250);
    	    studentPanel.setLayout(new GridLayout(10, 3, 10, 5));
    	    mainPanel.add(studentPanel);
    	    
    	    presentButtons = new JRadioButton[2][10];
    	    absentButtons = new JRadioButton[2][10];
    	    updateStudentList();
    	    
    	    submitButton = new JButton("Submit");
    	    submitButton.setBounds(160, 450, 100, 30);
    	    mainPanel.add(submitButton);

    	    submitButton.addActionListener(e -> submitAttendance());
    	    timetableTable = new JTable();
    	    timetableScrollPane = new JScrollPane(timetableTable);
    	    timetableScrollPane.setBounds(700, 20, 250, 150);
    	    mainPanel.add(timetableScrollPane);
    	    
    	    updateTimetable();
    	}
    	private void updateStudentList() {
    	    studentPanel.removeAll();
    	    int classIndex = classComboBox.getSelectedIndex();
    	    ButtonGroup[] buttonGroups = new ButtonGroup[10];
    	    for (int i = 0; i < 10; i++) {
    	        buttonGroups[i] = new ButtonGroup();
    	        JLabel studentLabel = new JLabel(students[classIndex][i]);
    	        studentPanel.add(studentLabel);

    	        presentButtons[classIndex][i] = new JRadioButton("Present");
    	        absentButtons[classIndex][i] = new JRadioButton("Absent");

    	        buttonGroups[i].add(presentButtons[classIndex][i]);
    	        buttonGroups[i].add(absentButtons[classIndex][i]);

    	        studentPanel.add(presentButtons[classIndex][i]);
    	        studentPanel.add(absentButtons[classIndex][i]);
    	    }

    	    studentPanel.revalidate();
    	    studentPanel.repaint();
    	}
    	private void updateTimetable() {
    	    int classIndex = classComboBox.getSelectedIndex();
    	    String[][] timetable = (classIndex == 0) ? ibscTimetable : iibscTimetable;
    	    
    	    String[] columnNames = {"Day", "Hours"};
    	    DefaultTableModel model = new DefaultTableModel(timetable, columnNames);
    	    timetableTable.setModel(model);
    	}
    	private void initializeDB() {
    	    try {
    	        connection = DriverManager.getConnection("jdbc:mysql://localhost:3306/AttendanceDB", "root", "TAMILSELVAN@2006");
    	    } catch (SQLException e) {
    	        e.printStackTrace();
    	    }
    	}

    	private void submitAttendance() {
    	    int classIndex = classComboBox.getSelectedIndex();
    	    for (int i = 0; i < 10; i++) {
    	        if (!presentButtons[classIndex][i].isSelected() && !absentButtons[classIndex][i].isSelected()) {
    	            JOptionPane.showMessageDialog(this, "Please mark attendance for all students.", "Incomplete Attendance", JOptionPane.WARNING_MESSAGE);
    	            return;
    	        }
    	    }
    	    try {
    	        String sql = "INSERT INTO Att (student_name, class_name, date, status) VALUES (?, ?, ?, ?)";
    	        PreparedStatement stmt = connection.prepareStatement(sql);
    	        java.sql.Date sqlDate = new java.sql.Date(dateChooser.getDate().getTime());
    	        for (int i = 0; i < 10; i++) {
    	            stmt.setString(1, students[classIndex][i]);
    	            stmt.setString(2, (classIndex == 0) ? "I BSc. CSCY" : "II BSc. CSCY");
    	            stmt.setDate(3, sqlDate);
    	            stmt.setString(4, presentButtons[classIndex][i].isSelected() ? "Present" : "Absent");
    	            stmt.executeUpdate();
    	        }
    	        JOptionPane.showMessageDialog(this, "Attendance submitted successfully.", "Success", JOptionPane.INFORMATION_MESSAGE);
    	    } catch (SQLException e) {
    	        e.printStackTrace();
    	    }
    	}

    	private void checkWeekend() {
    	    Calendar selectedDate = Calendar.getInstance();
    	    selectedDate.setTime(dateChooser.getDate());
    	    int dayOfWeek = selectedDate.get(Calendar.DAY_OF_WEEK);
    	    if (dayOfWeek == Calendar.SATURDAY || dayOfWeek == Calendar.SUNDAY) {
    	        JOptionPane.showMessageDialog(this, "Attendance cannot be marked on weekends.", "Invalid Selection", JOptionPane.WARNING_MESSAGE);
    	        dateChooser.setDate(null);
    	    }
    	} 
    	private void updateSubjectLabel() {
    	    int classIndex = classComboBox.getSelectedIndex();
    	    String subject = (classIndex == 0) ? "PROBLEM SOLVING USING C" : "JAVA PROGRAMMING";
    	    subjectLabel.setText("Subject: " + subject);
    	}
}